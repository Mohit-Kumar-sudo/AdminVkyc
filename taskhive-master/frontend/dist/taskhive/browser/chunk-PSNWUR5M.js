import{C as a,Eb as d,F as s,X as c,nb as u}from"./chunk-H3JZIXOS.js";var n=class extends Error{};n.prototype.name="InvalidTokenError";function f(r){return decodeURIComponent(atob(r).replace(/(.)/g,(e,t)=>{let o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}function g(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return f(e)}catch{return atob(e)}}function h(r,e){if(typeof r!="string")throw new n("Invalid token specified: must be a string");e||(e={});let t=e.header===!0?0:1,o=r.split(".")[t];if(typeof o!="string")throw new n(`Invalid token specified: missing part #${t+1}`);let l;try{l=g(o)}catch(i){throw new n(`Invalid token specified: invalid base64 for part #${t+1} (${i.message})`)}try{return JSON.parse(l)}catch(i){throw new n(`Invalid token specified: invalid json for part #${t+1} (${i.message})`)}}var p=class r{constructor(e,t){this.route=e;this.platformId=t}decodedToken=null;token=null;TOKEN_KEY="Token";REFRESH_KEY="refreshToken";USER_KEY="user";isBrowser(){return u(this.platformId)}setToken(e,t){if(this.isBrowser())try{e===null?localStorage.removeItem(this.TOKEN_KEY):localStorage.setItem(this.TOKEN_KEY,e),t==null?localStorage.removeItem(this.REFRESH_KEY):localStorage.setItem(this.REFRESH_KEY,t),this.token=e,this.decodedToken=null}catch{}}getToken(){if(!this.isBrowser())return this.token;try{let e=localStorage.getItem(this.TOKEN_KEY);return this.token=e,e}catch{return null}}getRefreshToken(){if(!this.isBrowser())return null;try{return localStorage.getItem(this.REFRESH_KEY)}catch{return null}}deleteToken(){if(this.isBrowser())try{localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.REFRESH_KEY),localStorage.removeItem(this.USER_KEY)}catch{}this.token=null,this.decodedToken=null,this.isBrowser()&&this.route.navigate(["/login"])}setUser(e){if(this.isBrowser())try{localStorage.setItem(this.USER_KEY,JSON.stringify(e))}catch{}}getUser(){if(!this.isBrowser())return null;try{let e=localStorage.getItem(this.USER_KEY);return e?JSON.parse(e):null}catch{return null}}decodeToken(){let e=this.getToken();if(!e){this.token=null,this.decodedToken=null;return}try{this.token=e,this.decodedToken=h(e)}catch{this.decodedToken=null}}getDecodeToken(){return this.decodedToken||this.decodeToken(),this.decodedToken}getExpiryTime(){let e=this.getDecodeToken();return e&&e.exp?e.exp:null}isTokenExpired(e=5e3){let t=this.getExpiryTime();return t?t*1e3-Date.now()<e:!0}static \u0275fac=function(t){return new(t||r)(s(d),s(c))};static \u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})};var R={production:!1,url:"https://api.taskhive.co.in"};export{R as a,p as b};
